# ログイン画面要件定義

## 1. 機能概要

### 目的と主な機能
- 経営陣・意思決定者が「プランナビ」タイムスケジュール管理アプリにアクセスするための認証機能を提供
- メールアドレス/パスワードまたはソーシャルログイン（Google）による認証
- 招待制による新規ユーザー登録

### 全体要件との関連性
- 本アプリケーションは経営陣・意思決定者向けの専門的なツールであり、招待制によるクローズドなユーザー管理が必要
- ダッシュボードや詳細なプロジェクト管理機能へのゲートウェイとして機能
- 高級感のあるUI/UXを維持し、ターゲットユーザーに相応しい洗練された外観を提供

### 想定ユーザー
- 企業経営者、役員、プロジェクトマネージャー
- デジタルリテラシーは様々なレベルに対応する必要あり
- モバイルおよびデスクトップの両方の環境からアクセス

### 主要ユースケース
1. **初回ログイン**：招待を受けたユーザーが初回ログインを行う
2. **通常ログイン**：登録済みユーザーが日常的にログイン
3. **パスワードリセット**：パスワードを忘れたユーザーが再設定
4. **ソーシャルログイン**：Googleアカウントを使った簡易ログイン
5. **新規ユーザー登録**：招待コードを持つユーザーがアカウント作成

## 2. UI要素の詳細

### 各画面の構成要素

#### ログイン画面
- アプリロゴ・名称表示
- ログイン/新規登録タブまたは切り替えリンク
- メールアドレス入力フィールド
- パスワード入力フィールド
- 「ログイン情報を保存する」チェックボックス
- ログインボタン
- Googleログインボタン
- パスワードを忘れた場合のリンク
- 新規登録へのリンク

#### 新規登録画面
- アプリロゴ・名称表示
- ログイン/新規登録タブまたは切り替えリンク
- メールアドレス入力フィールド
- パスワード入力フィールド
- 招待コード入力フィールド
- 登録ボタン
- Googleログインボタン
- ログイン画面へのリンク
- 招待制についての説明テキスト

### 入力フィールドと検証ルール

#### メールアドレス
- 必須項目
- 有効なメールアドレス形式であること
- 最大長：256文字

#### パスワード
- 必須項目
- 最小8文字以上
- 英数字混合であること
- 特殊文字を含むことが望ましい
- 表示/非表示の切り替え機能

#### 招待コード
- 新規登録時のみ必須
- 英数字の組み合わせ（例：XXXX-XXXX-XXXX形式）
- 有効期限付き（管理画面で設定可能）

### ボタンとアクション

#### ログインボタン
- アクション：認証情報を検証し、成功時はダッシュボードへリダイレクト
- 状態：入力フィールドが埋まっている場合のみ有効

#### Googleログインボタン
- アクション：Googleの認証フローを開始
- 状態：常に有効

#### 「パスワードをお忘れですか？」リンク
- アクション：パスワードリセットフローを開始
- 状態：常に有効

#### 「新規登録」/「ログイン」切り替えリンク
- アクション：登録モードとログインモードを切り替え
- 状態：常に有効

### レスポンシブ対応の要件
- モバイル端末（スマートフォン）対応：最小幅320px
- タブレット対応：600px〜1024px
- デスクトップ対応：1024px以上
- 入力フォームは画面サイズに応じて適切に調整
- タッチ操作に適したUI要素のサイズ・間隔の確保

### 既存UIコンポーネントの再利用
- Material UIコンポーネントの活用
- プロジェクト全体で統一されたカラーパレットの使用
- コンポーネントライブラリからのフォーム要素の再利用

## 3. データ構造と連携

### 扱うデータの種類と形式

#### ユーザー認証情報
```json
{
  "email": "string",
  "password": "string (ハッシュ化して保存)",
  "rememberMe": "boolean"
}
```

#### 新規登録情報
```json
{
  "email": "string",
  "password": "string (ハッシュ化して保存)",
  "invitationCode": "string"
}
```

#### ソーシャルログイン情報
```json
{
  "provider": "string (例: 'google')",
  "providerUserId": "string",
  "email": "string",
  "name": "string (オプション)",
  "profilePicture": "string URL (オプション)"
}
```

### 既存データモデルとの関連
- ユーザーモデルとの関連付け
- 権限・ロールシステムとの統合
- 招待コードシステムとの連携

### データの永続化要件
- ユーザー認証情報のセキュアな保存
- 「ログイン情報を保存」機能のためのローカルストレージまたはCookieの使用
- セッション管理とトークンの安全な保存

## 4. API・バックエンド連携

### 必要なAPIエンドポイント

#### 認証関連
- `POST /api/auth/login` - ログイン処理
- `POST /api/auth/register` - 新規ユーザー登録
- `POST /api/auth/google` - Googleログイン処理
- `POST /api/auth/forgot-password` - パスワードリセットリクエスト
- `POST /api/auth/reset-password` - 新パスワード設定
- `POST /api/auth/verify-invitation` - 招待コード検証
- `GET /api/auth/me` - 現在のユーザー情報取得

### リクエスト/レスポンス形式

#### ログインリクエスト
```json
{
  "email": "user@example.com",
  "password": "password123",
  "rememberMe": true
}
```

#### ログインレスポンス（成功時）
```json
{
  "success": true,
  "token": "JWT_TOKEN",
  "user": {
    "id": "user_id",
    "email": "user@example.com",
    "name": "User Name",
    "role": "admin"
  }
}
```

#### 登録リクエスト
```json
{
  "email": "newuser@example.com",
  "password": "password123",
  "invitationCode": "ABCD-1234-EFGH"
}
```

#### エラーレスポンス
```json
{
  "success": false,
  "message": "Invalid credentials",
  "errors": [
    {
      "field": "email",
      "message": "メールアドレスが不正です"
    }
  ]
}
```

### 必要な環境変数リスト
- `API_BASE_URL` - バックエンドAPIのベースURL
- `GOOGLE_CLIENT_ID` - GoogleログインのクライアントID
- `AUTH_TOKEN_EXPIRY` - 認証トークンの有効期限（秒）
- `AUTH_COOKIE_NAME` - 認証Cookie名

## 5. 実装ファイルリスト

### 実装が必要な具体的なファイルパス

#### フロントエンド
- `/src/pages/Login.jsx` - ログイン/登録ページコンポーネント
- `/src/components/LoginForm.jsx` - ログインフォームコンポーネント
- `/src/components/RegisterForm.jsx` - 登録フォームコンポーネント
- `/src/utils/auth.js` - 認証ユーティリティ関数
- `/src/api/authApi.js` - 認証API連携モジュール
- `/src/contexts/AuthContext.jsx` - 認証状態管理コンテキスト
- `/src/assets/css/login.css` - ログイン画面専用スタイル

#### バックエンド
- `/api/controllers/authController.js` - 認証コントローラー
- `/api/models/User.js` - ユーザーモデル
- `/api/models/Invitation.js` - 招待コードモデル
- `/api/middleware/auth.js` - 認証ミドルウェア
- `/api/services/emailService.js` - メール送信サービス（パスワードリセット用）

### 各ファイルの役割と責任

#### Login.jsx
- ログイン/登録画面の全体レイアウト
- 状態管理とフォーム切り替え
- エラー表示とリダイレクト処理

#### LoginForm.jsx / RegisterForm.jsx
- 入力フォーム表示と検証
- フォーム送信処理
- エラーメッセージ表示

#### auth.js
- トークン管理（保存、取得、削除）
- 認証状態チェック
- リダイレクト処理

#### authApi.js
- バックエンドAPI呼び出し
- リクエスト/レスポンス処理
- エラーハンドリング

#### AuthContext.jsx
- グローバルな認証状態管理
- ログイン/ログアウト処理
- 認証状態の永続化

### 既存コンポーネントの再利用方法
- Material UIコンポーネントの活用
- 共通フォームバリデーションの再利用
- アラート/通知コンポーネントの再利用
- ローディングインジケータの再利用